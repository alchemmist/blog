{{ define "main" }}
<h1>Книги</h1>

<style>
    .genre-section {
        margin-bottom: 2em;
    }

    .genre-toggle {
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
        margin: 1em 0;
        background: none;
        border: none;
        text-align: left;
        width: 100%;
        padding: 0.5em 0;
        border-bottom: 1px solid #ccc;
    }

    .books-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 1em;
        margin-top: 1em;
    }

    .book-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 0.5em;
        background-color: #f9f9f9;
        text-align: center;
        font-size: 0.9em;
        transition: box-shadow 0.2s;
    }

    .book-card:hover {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .book-card img {
        max-height: 140px;
        object-fit: cover;
        border-radius: 4px;
        margin-bottom: 0.5em;
    }

    .book-title {
        font-weight: bold;
        margin-bottom: 0.3em;
    }

    details summary {
        cursor: pointer;
        font-size: 1.1em;
        padding: 0.3em 0;
    }

    details[open] summary {
        margin-bottom: 0.5em;
    }
</style>

{{ $books := site.Data.books }}
{{ $grouped := dict }}

{{ range $books }}
    {{ $genre := .genre | lower }}
    {{ with index $grouped $genre }}
        {{ $grouped = merge $grouped (dict $genre (append . .)) }}
    {{ else }}
        {{ $grouped = merge $grouped (dict $genre (slice .)) }}
    {{ end }}
{{ end }}

{{ range $genre, $items := $grouped }}
    <div class="genre-section">
        <details>
            <summary>{{ $genre | title }}</summary>
            <div class="books-grid">
                {{ range $items }}
                <div class="book-card">
                    <img src="{{ .cover }}" alt="{{ .title }}">
                    <div class="book-title">{{ .title }}</div>
                    <div>{{ .author }}</div>
                    <div><em>{{ .status }}</em></div>
                    <div style="font-size: 0.8em; color: #777;">{{ .date }}</div>
                </div>
                {{ end }}
            </div>
        </details>
    </div>
{{ end }}

{{ end }}


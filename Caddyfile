img.alchemmist.xyz {
    encode zstd gzip

    reverse_proxy * https://images.weserv.nl {
        transport http {
            tls
        }
        header_up Host images.weserv.nl
        header_up User-Agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36"
        header_up Accept "image/webp,image/apng,image/*,*/*;q=0.8"
        header_up Referer "https://images.weserv.nl/"
    }

    header {
        Access-Control-Allow-Origin *
    }
}

wg-easy.alchemmist.xyz {
   reverse_proxy wg-easy:51821
}

soft.alchemmist.xyz {
    reverse_proxy moss:8081
}

remark42.alchemmist.xyz {
    reverse_proxy remark42:8080
}

mail.alchemmist.xyz {
    respond "Mail server endpoint" 200
}

umami.alchemmist.xyz {
    reverse_proxy umami:3000
}

cats.alchemmist.xyz {
    reverse_proxy cats:5173
}

devsyringe.alchemmist.xyz {
    redir https://devsyringe.xyz{uri} 301
}

alchemmist.xyz, www.alchemmist.xyz {
    root * /srv
    encode gzip zstd
    file_server

    header *.js Cache-Control "public, max-age=180000"
    header *.css Cache-Control "public, max-age=1200"
    header *.html Cache-Control "public, max-age=100"
    header *.woff2 Cache-Control "public, max-age=31536000, immutable"
    header *.png Cache-Control "public, max-age=31536000, immutable"
    header *.jpg Cache-Control "public, max-age=31536000, immutable"
    header *.jpeg Cache-Control "public, max-age=31536000, immutable"
    header *.webp Cache-Control "public, max-age=31536000, immutable"
    header *.svg Cache-Control "public, max-age=31536000, immutable"
    header *.ico Cache-Control "public, max-age=31536000, immutable"
    header *.mp4 Cache-Control "public, max-age=31536000, immutable"
    header *.gif Cache-Control "public, max-age=31536000, immutable"

    header /sitemap.xml Content-Type application/xml
    header /en/sitemap.xml Content-Type application/xml
    header /ru/sitemap.xml Content-Type application/xml
    header /robots.txt Content-Type text/plain
    header /index.xml Content-Type application/rss+xml

    redir /cv/en/long https://alchemmist.github.io/CV/pdf/long-eng.pdf
    redir /cv/en/go https://alchemmist.github.io/CV/pdf/go-eng.pdf
    redir /cv/en/python https://alchemmist.github.io/CV/pdf/python-eng.pdf
    redir /cv/ru/long https://alchemmist.github.io/CV/pdf/long-rus.pdf
    redir /cv/ru/short https://alchemmist.github.io/CV/pdf/short-rus.pdf
    redir /cv/ru/go https://alchemmist.github.io/CV/pdf/go-rus.pdf
    redir /cv/ru/python https://alchemmist.github.io/CV/pdf/python-rus.pdf

    redir /rss /index.xml
    redir /feed /index.xml
    redir /ru/ / 301
    redir /ru / 301
}
